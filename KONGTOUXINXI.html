<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <title>农民币挖矿 - Nongmingcoin Miner</title>
  <link rel="stylesheet" href="style.css">
  <link rel="icon" type="image/png" href="images/nongmingcoin-logo.png">
  <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
</head>
<body>
  <header class="site-header">
    <div class="banner-overlay">
      <h1 class="shouyedingbu1">农民币 · 挖矿入口</h1>
      <h2 class="shouyedingbu2">每小时产币，每10%减半，完全去中心化</h2>
      <p class="shouyedingbu3">返回首页：<a href="index.html">社区信息展示页</a></p>
    </div>
    <nav class="nav-bar">
      <ul>
        <li><a href="index.html">首页</a></li>
        <li><a href="about.html">关于项目</a></li>
        <li><a href="faq.html">常见问题</a></li>
        <li><a href="contact.html">联系我们</a></li>
        <li><a href="KONGTOUXINXI.html" class="active">挖矿页面</a></li>
        <li><a href="BUYNFT.html">NFT信息</a></li>
        <li><a href="XIANGMUDONGTAI.html">项目动态</a></li>
        <li><a href="whitepaper.html">项目白皮书</a></li>
        <li><a href="XIANGMUHEZUO.html" >项目合作</a></li>
        <li><a href="tools.html" >实用工具</a></li>
      </ul>
    </nav>
  </header>

  <main class="main-content">
    <section>
      <h2>团队矿池</h2>
      <p>连接钱包后可查看质押状态并开始产出农民币。</p>
      <button onclick="connectWallet('team')">连接钱包</button>
      <p id="walletAddress_team">尚未连接</p>
      <p id="nftCount_team">持有 NFT 数量：-</p>
      <p id="isStaking_team">质押状态：-</p>
      <p id="pendingReward_team">可领取农民币：-</p>
      <p id="currentRate_team">当前产出速率：-</p>
      <br>
      <button onclick="approveNFT('team')">授权 NFT</button>
      <button onclick="stake('team')">质押NFT</button>
      <button onclick="claim('team')">领取收益</button>
      <button onclick="unstake('team')">解除质押</button>
    </section>
    <hr>
    <section>
      <h2>社区矿池</h2>
      <p>连接钱包后可查看质押状态并开始产出农民币。</p>
      <button onclick="connectWallet('community')">连接钱包</button>
      <p id="walletAddress_community">尚未连接</p>
      <p id="nftCount_community">持有 NFT 数量：-</p>
      <p id="isStaking_community">质押状态：-</p>
      <p id="pendingReward_community">可领取农民币：-</p>
      <p id="currentRate_community">当前产出速率：-</p>
      <br>
      <button onclick="approveNFT('community')">授权 NFT</button>
      <button onclick="stake('community')">质押NFT</button>
      <button onclick="claim('community')">领取收益</button>
      <button onclick="unstake('community')">解除质押</button>
    </section>
      <section>
    <h2>赞助我们</h2>
    <p>如果你认可农民币的理念和技术实践，欢迎通过以下方式支持我们：</p>
     <li>
      以太坊地址：<br>
      <span style="font-weight:bold;word-break:break-all;">0x6B46E77eC6d70712d1E0C8e180a1f44775AF4b52</span>
      <button onclick="navigator.clipboard.writeText('0x6B46E77eC6d70712d1E0C8e180a1f44775AF4b52')">复制地址</button>
      </li>
      <li>
      也可通过 <a href="https://nongmingcoin.com" target="_blank">nongmingcoin.com</a> 或 Telegram/Twitter 联系我们
      </li>
      <p><b>感谢您的支持！</b></p>
    </section>
  </main>

  <footer class="site-footer">
    <p>© 2025 ｜ <a href="https://nongmingcoin.com" target="_blank">NONGMINGCOIN.COM</a></p>
  </footer>

<script>
const CONFIG = {
  team: {
    pool: "0xa99bA9b45991D34bDbe0606D1D86B0229444bB16",
    nft: "0xBB91925dafA50E91C8aD1416B5c452F9b156EF73"
  },
  community: {
    pool: "0x4a7AacFe662d8314E0D885B30AE42D04C1960579",
    nft: "0x1f09E222fb8F81c6D41415822a63C9C4Ef448dcF"
  }
};

let provider, signer, userAddress;
const poolABI = [
  "function stake() external",
  "function claim() public",
  "function unstake() external",
  "function getPendingReward(address user) external view returns (uint256)",
  "function getCurrentRate() public view returns (uint256)",
  "function stakes(address user) external view returns (uint256,uint256,uint256,bool)"
];

const nftABI = [
  "function balanceOf(address account, uint256 id) external view returns (uint256)",
  "function setApprovalForAll(address operator, bool approved) external",
  "function isApprovedForAll(address owner, address operator) external view returns (bool)"
];

async function connectWallet(poolType) {
  if (!window.ethereum) return alert("请安装 MetaMask");
  provider = new ethers.providers.Web3Provider(window.ethereum);
  await provider.send("eth_requestAccounts", []);
  signer = provider.getSigner();
  userAddress = await signer.getAddress();
  document.getElementById(`walletAddress_${poolType}`).textContent = `当前地址：${userAddress}`;
  updateInfo(poolType);
}

async function updateInfo(poolType) {
  try {
    const pool = new ethers.Contract(CONFIG[poolType].pool, poolABI, signer);
    const nft = new ethers.Contract(CONFIG[poolType].nft, nftABI, signer);
    const count = await nft.balanceOf(userAddress, 1);
    const stake = await pool.stakes(userAddress);
    const pending = await pool.getPendingReward(userAddress);
    const rate = await pool.getCurrentRate();

    document.getElementById(`nftCount_${poolType}`).textContent = `持有 NFT 数量：${count}`;
    document.getElementById(`isStaking_${poolType}`).textContent = `质押状态：${stake[3] ? "已质押" : "未质押"}`;
    document.getElementById(`pendingReward_${poolType}`).textContent = `可领取农民币：${ethers.utils.formatEther(pending)} NM`;
    document.getElementById(`currentRate_${poolType}`).textContent = `当前产出速率：${ethers.utils.formatEther(rate)} NM / 小时 / 每张NFT`;
  } catch (err) {
    console.error("更新信息失败：", err);
  }
}

async function approveNFT(poolType) {
  try {
    const nft = new ethers.Contract(CONFIG[poolType].nft, nftABI, signer);
    const tx = await nft.setApprovalForAll(CONFIG[poolType].pool, true);
    await tx.wait();
    alert("✅ 授权成功！");
  } catch (err) {
    alert("❌ 授权失败：" + (err.reason || err.message));
  }
}

async function stake(poolType) {
  try {
    const pool = new ethers.Contract(CONFIG[poolType].pool, poolABI, signer);
    const tx = await pool.stake({ gasLimit: 300000 });
    await tx.wait();
    alert("✅ 质押成功！");
    updateInfo(poolType);
  } catch (err) {
    alert("❌ 质押失败：" + (err.reason || err.message));
  }
}

async function claim(poolType) {
  try {
    const pool = new ethers.Contract(CONFIG[poolType].pool, poolABI, signer);
    const tx = await pool.claim({ gasLimit: 200000 });
    await tx.wait();
    alert("✅ 领取成功！");
    updateInfo(poolType);
  } catch (err) {
    alert("❌ 提取失败：" + (err.reason || err.message));
  }
}

async function unstake(poolType) {
  try {
    const pool = new ethers.Contract(CONFIG[poolType].pool, poolABI, signer);
    const tx = await pool.unstake({ gasLimit: 300000 });
    await tx.wait();
    alert("✅ 成功解除质押！");
    updateInfo(poolType);
  } catch (err) {
    alert("❌ 解除质押失败：" + (err.reason || err.message));
  }
}
</script>
</body>
</html>
